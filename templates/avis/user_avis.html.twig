{% extends 'base.html.twig' %}

{% block body %}
<section class="container py-5">

    {# Message de bienvenue #}
    {% if is_granted('IS_AUTHENTICATED_FULLY') %}
        <div class="alert alert-info d-flex align-items-center justify-content-center gap-3 mb-4 shadow-sm rounded-pill">
            <img src="{{ asset('images/2289_SkVNQSBGQU1PIDEwMjgtMTIy.jpg') }}" alt="Avatar" class="rounded-circle" width="40" height="40">
            Bonjour <strong>{{ app.user.nom }}</strong>, merci de partager votre avis avec nous.
        </div>
    {% endif %}

    {# Boutons : Déconnexion | Supprimer tous les avis | Contacter #}
    {% if is_granted('IS_AUTHENTICATED_FULLY') %}
        <div class="text-end mb-4 d-flex justify-content-center gap-2 flex-wrap">
            <a href="{{ path('app_logout') }}" class="btn btn-outline-primary btn-sm">
                <i class="bi bi-box-arrow-right"></i> Déconnexion
            </a>
            <form method="post" action="{{ path('avis_delete_all') }}" onsubmit="return confirm('Supprimer tous vos avis ?');">
                <button class="btn btn-outline-warning btn-sm">
                    <i class="bi bi-trash-fill"></i> Supprimer mes avis
                </button>
            </form>
            <a href="{{ path('app_contact') }}" class="btn btn-outline-success btn-sm">
                <i class="bi bi-envelope"></i> Contacter
            </a>
        </div>
    {% endif %}

    {# Titre principal #}
    <h2 class="text-center mb-5 fw-bold text-warning">Laissez votre avis</h2>

    {# Formulaire d’ajout d’avis #}
    <div class="row justify-content-center mb-5">
        <div class="col-md-8 shadow-sm border-0 card-bg  p-4 rounded-4">
            {{ form_start(form) }}
                <div class="mb-3">
                    {{ form_label(form.nomClient, 'Votre nom', {'label_attr': {'class': 'form-label text-warning'}}) }}
                    {{ form_widget(form.nomClient, {'attr': {'class': 'form-control text-secondary', 'placeholder': 'Entrez votre nom'}}) }}
                    {{ form_errors(form.nomClient) }}
                </div>
                <div class="mb-3">
                    {{ form_label(form.lieu, 'Lieu du chantier', {'label_attr': {'class': 'form-label text-warning'}}) }}
                    {{ form_widget(form.lieu, {'attr': {'class': 'form-control', 'placeholder': 'Ex : Paris, France'}}) }}
                    {{ form_errors(form.lieu) }}
                </div>
                <div class="mb-3">
                    {{ form_label(form.commentaire, 'Votre commentaire', {'label_attr': {'class': 'form-label text-warning'}}) }}
                    {{ form_widget(form.commentaire, {'attr': {'class': 'form-control', 'rows': 4, 'placeholder': 'Partagez votre expérience...'}}) }}
                    {{ form_errors(form.commentaire) }}
                </div>
                <div class="mb-3">
                    {{ form_label(form.note, 'Note attribuée', {'label_attr': {'class': 'form-label text-danger'}}) }}
                    {{ form_widget(form.note, {'attr': {'class': 'form-select'}}) }}
                    {{ form_errors(form.note) }}
                </div>
                {# <button type="submit" class="btn btn-primary w-100 mt-3 py-2">
                    {{ form_label(form.submit) }}
                </button> #}
            {{ form_end(form) }}
        </div>
    </div>

    {# Liste des avis #}
    <h2 class="text-center mb-5 fw-bold text-warning">Vos avis</h2>

    <div class="row g-4">
        {% for avis in pagination %}
            <div class="col-md-6 col-lg-4">
                <div class="card card-bg  card-animation h-100 shadow-sm border-0 bg-light p-4 rounded-4">
                    <div class="card-bodyd-flex flex-column p-4">
                        <div class="d-flex align-items-center mb-3">
                            <img src="{{ asset('images/2289_SkVNQSBGQU1PIDEwMjgtMTIy.jpg') }}" alt="Avatar" class="rounded-circle me-3 border" style="width: 50px; height: 50px; object-fit: cover;">
                            <div>
                                <p class="mb-0 fw-bold text-primary">{{ avis.nomClient }}</p>
                                <small class="text-muted text-secondary"><i class="bi bi-geo-alt-fill text-secondary"></i> {{ avis.lieu }}</small>
                            </div>
                        </div>
                        <p class="mb-3 fst-italic text-warning flex-grow-1">
                            "{{ avis.commentaire }}"
                        </p>
                        <div class="d-flex text-danger fs-5 mb-3" style="color: #2A4853;">
                            {{ avis.etoilesHtml|raw }}
                        </div>
                        <form method="post" action="{{ path('avis_delete', {'id': avis.id}) }}" onsubmit="return confirm('Supprimer cet avis ?');">
                            <input type="hidden" name="_method" value="POST">
                            <button type="submit" class="btn btn-sm btn-outline-warning mt-auto">
                                <i class="bi bi-trash"></i> Supprimer
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        {% else %}
            <div class="col-12">
                <div class="alert alert-light text-center py-5 rounded-4">
                    <i class="bi bi-chat-dots fs-1 text-secondary"></i>
                    <p class="mb-0 mt-2 text-muted">Vous n'avez encore aucun avis.</p>
                </div>
            </div>
        {% endfor %}
    </div>

    {# Pagination #}
    <div class="mt-4 d-flex justify-content-center">
        {{ knp_pagination_render(pagination) }}
        
    </div>

</section>
{% endblock %}



{# color: #2a4853;
    color: #538ea4;
    color: #9fc2ce;
    color: #eef4f6;

    color: #1a2c33;
    color: #53352a;
    color: #33201a; #}